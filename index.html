<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Courbes de Prix des Items</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="journalierJS/data_js.js"></script>
    <script src="flip/data_flip.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: burlywood;
        }
        #charts-container {
            width: 90%;
            margin: 0 auto;
        }
        canvas {
            max-width: 100%;
            height: 50vh;
            display: block;
            margin-bottom: 20px;
        }
        h1 {
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>Courbes de Prix des Items</h1>
    <div id="charts-container">
        <canvas id="mainChart"></canvas>
        <canvas id="flipChart"></canvas>
    </div>

    <script>
        function createChart(ctx, labels, prixAchat, prixVente) {
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Prix d\'Achat',
                            data: prixAchat,
                            borderColor: 'rgb(75, 192, 192)',
                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                            fill: false
                        },
                        {
                            label: 'Prix de Vente moyen',
                            data: prixVente,
                            borderColor: 'rgb(255, 99, 132)',
                            backgroundColor: 'rgba(255, 99, 132, 0.2)',
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Items'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Prix'
                            }
                        }
                    }
                }
            });
        }

        function createFlipChart(ctx, labels, flipValues) {
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Valeur de Flip',
                            data: flipValues,
                            borderColor: 'rgb(75, 192, 192)',
                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Items'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Valeur de Flip'
                            }
                        }
                    }
                }
            });
        }

        // Données pour le premier graphique
        const items = data.items_en_benefice;

        // Tri des items par prix de vente décroissant
        items.sort((a, b) => b.prix_vente - a.prix_vente);

        const labels = items.map(item => item.item_id);
        const prixAchat = items.map(item => item.prix_achat);
        const prixVente = items.map(item => item.prix_vente);

        const container = document.getElementById('charts-container');
        const mainChartCanvas = document.getElementById('mainChart').getContext('2d');
        createChart(mainChartCanvas, labels, prixAchat, prixVente);

        // Données pour le deuxième graphique
        const flips = data_flips.flips;

        // Filtrer les flips pour ne conserver que ceux dont le prix d'achat > 0 et BuyMovingWeek/SellMovingWeek > 100
        const filteredFlips = flips.filter(flip => flip.buy_price > 0 && flip.buyMovingWeek > 100 && flip.sellMovingWeek > 100);

        // Trier les flips par valeur de flip décroissante
        filteredFlips.sort((a, b) => a.flip_value - b.flip_value);

        // Extraire les labels et les valeurs des flips filtrés
        const flipLabels = filteredFlips.map(flip => flip.product_id);
        const flipValues = filteredFlips.map(flip => Math.abs(flip.flip_value)); // Afficher en positif

        const flipChartCanvas = document.getElementById('flipChart').getContext('2d');
        createFlipChart(flipChartCanvas, flipLabels, flipValues);
    </script>
</body>
</html>